/** @jest-environment jsdom */

const getJpegQuality = require('../src');

test('basic jpeg qual test Q=73%', () => {
    expect(
        getJpegQuality(
            'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QByRXhpZgAATU0AKgAAAAgABQEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAMAAAExAAIAAAAQAAAAWlEAAAQAAAABAAAAAAAAAAAAAJOjAAAD6AAAk6MAAAPocGFpbnQubmV0IDUuMC45AP/bAEMACQYGCAYFCQgHCAoJCQoNFg4NDAwNGhMUEBYfHCEgHxweHiMnMiojJS8lHh4rOywvMzU4ODghKj1BPDZBMjc4Nf/bAEMBCQoKDQsNGQ4OGTUkHiQ1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1Nf/AABEIABoAIAMBEgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APbKxPFk+oWmk/atPdh9ncPKka5Z07j2rz3obRjzOyMy+1hj8RYLB72aK0iiDPEuFQyYLDJxk9Bxn0rh012ez1c6quTNuLKzkvjIIwSfY1l7X3rdD0Pq9qNup6aniCMapeRXBSC2tYRK0sp24HJYnI4xx1x/h55qeo3HizR7qDTNOSfVnImnjdysU0aEMR+JwMHg9OhxTpuc6rTty/iclSlyR13O98P+O/D/AIou5LbSNQWedF3+W0boWXONy7gNw9xXOeD9O8QnV7G71O5e6tGi85BI0bqm5ThonREOMEAoVH3gQTg10yiktDnTO6vblrS381YXmAI3BOoXucd8elT1kylbqcNqPga41G+mvNPkgs4ZRuSF8tk+px93PoM/0rue1S4Re6No16kVZM5jwR4dTSLOWabf9tkZknVsYXB6D2PBz71oaCo8vdgbm35OOT81OKS0QqspS1bNZEWNFRFCqowABgAU6qMT/9k=',
        ),
    ).toBe(73);
});

test('basic jpeg qual test Q=45%', () => {
    expect(
        getJpegQuality(
            'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAXgBeAAD/4QByRXhpZgAATU0AKgAAAAgABQEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAExAAIAAAAQAAAAWlEAAAQAAAABAAAAAAAAAAAAAW8cAAAD6AABbxwAAAPocGFpbnQubmV0IDUuMC45AP/bAEMAEgwNEA0LEhAOEBQTEhUbLB0bGBgbNicpICxAOURDPzk+PUdQZldHS2FNPT5ZeVphaW1yc3JFVX2GfG+FZnBybv/bAEMBExQUGxcbNB0dNG5JPklubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubv/AABEIABoAIAMBEgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/AO2qjqz3EVr5tux/dkFlUZLCsCkrlWe6J19IGmdYlUEqMAFuT/kViC9eK6+1D7+cgnnFRz6nR7P3PM6YXyi5mWTCRxIGLMccd/pXPXNxJqlpLHbW4e7OHdWJCuo5/wA5pxbcvIylGyN7T9b0/UpWitLgPIoztKlcj1GeorO0i31A3UEtzIZIim8bipAyDypAH4jHetGkZm5PIYo9wQvg8gdQPWpDUjRhXOiyTzPNbskKMMhDk5P9K3aVky1UkkZeiWAtImd8+cxIcHt9P51ZsAME455/nQlYUm3uW1AUAKMAUtMk/9k=',
        ),
    ).toBe(45);
});

test('basic jpeg gray qual test Q=95%', () => {
    expect(
        getJpegQuality(
            'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAXQBdAAD/2wBDAAIBAQEBAQIBAQECAgICAgQDAgICAgUEBAMEBgUGBgYFBgYGBwkIBgcJBwYGCAsICQoKCgoKBggLDAsKDAkKCgr/wAALCAAaACABAREA/8QAGgAAAgIDAAAAAAAAAAAAAAAABwgFCQABBv/EAC4QAAEDAgQDBgcBAAAAAAAAAAQBBQYABwIIERQJUYEhJDFBRHEDFRcmNVShtP/aAAgBAQAAPwC+ikYuHfA/4PFDY7GO1335tiTSxCEmNAuMUYUx2RCy01xLqq+XdV1WjKPmmYg7qTiPTPGIwR6GRUV0LenkzbIgunelVNe6VA5PuK9kYz0zhztVl4v8I+SJqCQjC1FsxbZiME8FLGQtE3Qvtr0qW4hMozAW+sp9ULHv5f2qaKU9NLODuinUTlVXY2aaWwK9i5nBcKYnnEapIZRybpBU5V1t7r1yzPnYaWQGw1gxHG7BeIN8lLQ8nFCtUgahV3Sde31dGnh3Wpz2m3rhd0r93BJksTKjKPgaPBjUUKIpYhabtqKDED7V9WJtfWa0/wBdScONvov89ChpT4gpqbwQNU3QwvbqUntp/aR+9nCuuDdm4T1d6xz+xRFkdgtyFHTN0Vui+a/p9OdE/hm5OwsuUHcZdKcZeCbOrgSNKBSlTUTRddBdfJdN11pwGcFuZhBm5kb9sML5Vhnh1rVBTKX+XI9i/wDXR3r/2Q==',
        ),
    ).toBe(95);
});

test('with png should throw', () => {
    expect(() =>
        getJpegQuality(
            'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAaCAMAAADhRa4NAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAIiUExURfr6+vn5+fLy8uLi4vv7++Tk5Onp6dLS0vT09Ozs7Pb29vz8/Pj4+O/v7/Pz8/X19ebm5u7u7r+/v8LCwpSUlKKioujo6P39/d7e3vHx8fDw8Orq6tjY2FxcXFpaWnh4eLOzs+vr69/f3/f399ra2mVlZa+vr+fn58DAwODg4OPj4+3t7dDQ0Hp6epKSkqampqGhoYODg8/Pz1FRUXV1dZCQkNvb25iYmMHBwbCwsKmpqUpKSnBwcJaWlsnJydTU1LKysoyMjL29vURERBgYGAMDAzY2Np2dnYeHh2pqaoSEhFlZWaysrNzc3Kqqqq2trTg4OAEBATo6Oh4eHqWlpeXl5bm5uY2NjXNzc2lpaYCAgMjIyMzMzHx8fNXV1dbW1kdHRygoKK6urv7+/qSkpGdnZ87OzsXFxXFxccrKypmZmYmJiUZGRn19fbW1tY+Pj6CgoIWFhbi4uHZ2doaGhpOTk7q6us3NzWhoaI6OjjMzMw0NDSEhIbu7u3l5eaenp4uLi3d3d3t7e4KCgoGBgX5+fp+fn3JycicnJ6Ojo5ycnFhYWB8fH3R0dGFhYV9fXw8PDxcXFysrK5ubm2tra29vb21tbUxMTCkpKZWVlZeXl+Hh4VVVVWJiYl5eXkVFRVtbW1ZWVre3t25ubmRkZFJSUsvLy9nZ2YiIiJ6entPT02NjY76+vt3d3VRUVGBgYF1dXbGxsaurq8fHx9HR0dfX118ed+4AAAAJcEhZcwAADk0AAA5NAUbVaAkAAALcSURBVDhPZZJnWxNBFIXvbIZls3ezkwVh2QUJyaiBQAxNQKQEKwJRUREEghrFCipiwxKpYgMb2Csqgord/+cIyhfP13POLc/zwrwIIZKDJoCcqDiBqg4JNRelOqPgXAyg20hKXpJCKUl1qKaaZtkaZakKXQgIyekZSzM9WW4vGj6muhCRE0q58qc8r2XUmbl8hWb60Zed4wiYGbmWW6zJXQwgzQuuDFloKvkFhZbPIKZpoi7xvwsAVDtUVLwqIDtKSj3ZQLy0bLXDRFtbcMUEg5Svqai006qqwzVhVV+7bv2GjZtsE//5BEpqN9fVNyRakS11W/WkbY3btzXu2KnZAKgwRJs17Wpu2d3aRrX2ldGOPXv3VcX2ywc6TRm8FKnr4KFAdmnx4WjlEYgklh0NHevqrj5+4mR7aJkJTlFP7ik4ldV8uPf0mdDZnHNthU3h832NFy5e2ny5qQlUyhLOxitSrvQPDA4NjwwHr2YovtFrXf3Xb9y8FTR10BSv5Y8N1bR6xjzBAU90fPBkXtntO41379XcL51ISAcKEqV5g0WTY8H46IPJlp7Jh57Y1uFHPSsed11+EhBvIlfp075nxd3D0dHzz1+8rHj1ujM/MNVqsj4Z0QUGSn4KieVveqPd8ZbOV50n3r7r7cDp+veIR9LQAGAcFNmA/NbRgr66oeaZZwPxWcOg0xEbCKcILpVScWnuh9KP49H+uvjI0qKhTwq659IJJSpBsDlwQGJp7obi5w+C0YmW27E5GQMSQSRMo0AVSdPTXcDkXWOfv+we/zrzzZtagkARBS4igE4L9eQkR6Qqpbm8Pat7stZLXLl+8R7hjBGBnKyiNjUbziuZy9E5r86fCagcHZrKhDgBEGOQR9Z+/5SAYDhdVkb4h5MgM0SAz2NAUXlqI2vzeTnhKpOIP1lncwIlTRPQElXAomnCYCpfUFVsur1Q0v+U5/VfYPrbz+pfnP+FmZDfj3yWRVTnDDEAAAAASUVORK5CYII=',
        ),
    ).toThrow();
});
